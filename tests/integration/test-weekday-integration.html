<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ›œæ—¥è¡¨ç¤ºè¨­å®šæ©Ÿèƒ½ çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .test-result.passed {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-result.failed {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .test-summary {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        .mock-task-board {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin: 20px 0;
            transition: grid-template-columns 0.4s ease;
        }
        
        .mock-day-column {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            min-height: 100px;
            transition: all 0.4s ease;
        }
        
        .mock-day-column.hidden {
            display: none;
        }
        
        .mock-day-column.hiding {
            opacity: 0;
            transform: scaleX(0.8);
        }
        
        .mock-day-column.showing {
            opacity: 1;
            transform: scaleX(1);
        }
        
        .mock-task {
            background: #007bff;
            color: white;
            padding: 5px;
            margin: 5px 0;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .weekday-controls {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .weekday-controls label {
            margin-right: 15px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>æ›œæ—¥è¡¨ç¤ºè¨­å®šæ©Ÿèƒ½ çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-container">
        <h2>ãƒ†ã‚¹ãƒˆç’°å¢ƒ</h2>
        <p>ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯æ›œæ—¥è¡¨ç¤ºè¨­å®šæ©Ÿèƒ½ã®çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>
        
        <div class="weekday-controls">
            <h3>æ›œæ—¥è¡¨ç¤ºè¨­å®š</h3>
            <label><input type="checkbox" id="show-monday" checked> æœˆ</label>
            <label><input type="checkbox" id="show-tuesday" checked> ç«</label>
            <label><input type="checkbox" id="show-wednesday" checked> æ°´</label>
            <label><input type="checkbox" id="show-thursday" checked> æœ¨</label>
            <label><input type="checkbox" id="show-friday" checked> é‡‘</label>
            <label><input type="checkbox" id="show-saturday" checked> åœŸ</label>
            <label><input type="checkbox" id="show-sunday" checked> æ—¥</label>
        </div>
        
        <div class="mock-task-board" id="mock-task-board">
            <div class="mock-day-column" data-day="monday">
                <h4>æœˆæ›œæ—¥</h4>
                <div class="mock-task">ã‚¿ã‚¹ã‚¯1</div>
                <div class="mock-task">ã‚¿ã‚¹ã‚¯2</div>
            </div>
            <div class="mock-day-column" data-day="tuesday">
                <h4>ç«æ›œæ—¥</h4>
                <div class="mock-task">ã‚¿ã‚¹ã‚¯3</div>
            </div>
            <div class="mock-day-column" data-day="wednesday">
                <h4>æ°´æ›œæ—¥</h4>
                <div class="mock-task">ã‚¿ã‚¹ã‚¯4</div>
                <div class="mock-task">ã‚¿ã‚¹ã‚¯5</div>
            </div>
            <div class="mock-day-column" data-day="thursday">
                <h4>æœ¨æ›œæ—¥</h4>
            </div>
            <div class="mock-day-column" data-day="friday">
                <h4>é‡‘æ›œæ—¥</h4>
                <div class="mock-task">ã‚¿ã‚¹ã‚¯6</div>
            </div>
            <div class="mock-day-column" data-day="saturday">
                <h4>åœŸæ›œæ—¥</h4>
            </div>
            <div class="mock-day-column" data-day="sunday">
                <h4>æ—¥æ›œæ—¥</h4>
                <div class="mock-task">ã‚¿ã‚¹ã‚¯7</div>
            </div>
        </div>
        
        <button onclick="runAllIntegrationTests()">çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="resetTestEnvironment()">ç’°å¢ƒãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    
    <div class="test-container">
        <h2>ãƒ†ã‚¹ãƒˆçµæœ</h2>
        <div id="test-results"></div>
        <div id="test-summary" class="test-summary" style="display: none;"></div>
    </div>

    <script>
        // ãƒ†ã‚¹ãƒˆçµæœã‚’æ ¼ç´
        let integrationTestResults = {
            passed: 0,
            failed: 0,
            total: 0,
            details: []
        };

        // WeekdayManager ã®ãƒ¢ãƒƒã‚¯å®Ÿè£…
        class MockWeekdayManager {
            constructor() {
                this.dayNames = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                this.dayLabels = ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'];
                this.weekdaySettings = {
                    monday: true,
                    tuesday: true,
                    wednesday: true,
                    thursday: true,
                    friday: true,
                    saturday: true,
                    sunday: true
                };
            }
            
            toggleWeekday(dayName, visible) {
                if (this.dayNames.includes(dayName)) {
                    this.weekdaySettings[dayName] = visible;
                    return true;
                }
                return false;
            }
            
            getVisibleWeekdays() {
                return this.dayNames.filter(day => this.weekdaySettings[day]);
            }
            
            getHiddenWeekdays() {
                return this.dayNames.filter(day => !this.weekdaySettings[day]);
            }
            
            isWeekdayVisible(dayName) {
                return this.weekdaySettings[dayName] || false;
            }
        }

        const mockWeekdayManager = new MockWeekdayManager();

        /**
         * ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–¢æ•°
         */
        function runIntegrationTest(testName, testFunction) {
            integrationTestResults.total++;
            try {
                const result = testFunction();
                if (result === true) {
                    integrationTestResults.passed++;
                    integrationTestResults.details.push(`âœ… ${testName}: PASSED`);
                    displayTestResult(testName, 'passed', 'PASSED');
                } else {
                    integrationTestResults.failed++;
                    integrationTestResults.details.push(`âŒ ${testName}: FAILED - ${result}`);
                    displayTestResult(testName, 'failed', `FAILED - ${result}`);
                }
            } catch (error) {
                integrationTestResults.failed++;
                integrationTestResults.details.push(`âŒ ${testName}: ERROR - ${error.message}`);
                displayTestResult(testName, 'failed', `ERROR - ${error.message}`);
            }
        }

        /**
         * ãƒ†ã‚¹ãƒˆçµæœã‚’ç”»é¢ã«è¡¨ç¤º
         */
        function displayTestResult(testName, status, message) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${status}`;
            resultDiv.textContent = `${testName}: ${message}`;
            resultsDiv.appendChild(resultDiv);
        }

        /**
         * UIæ“ä½œã¨è¨­å®šå¤‰æ›´ã®é€£æºãƒ†ã‚¹ãƒˆ
         */
        function testUISettingIntegration() {
            // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèª
            const mondayCheckbox = document.getElementById('show-monday');
            const mondayColumn = document.querySelector('[data-day="monday"]');
            
            if (!mondayCheckbox || !mondayColumn) {
                return 'UIè¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãªã„';
            }
            
            // åˆæœŸçŠ¶æ…‹ã®ç¢ºèª
            if (!mondayCheckbox.checked) {
                return 'åˆæœŸçŠ¶æ…‹ã§ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„';
            }
            
            if (mondayColumn.classList.contains('hidden')) {
                return 'åˆæœŸçŠ¶æ…‹ã§æœˆæ›œæ—¥åˆ—ãŒéè¡¨ç¤ºã«ãªã£ã¦ã„ã‚‹';
            }
            
            // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’å¤–ã™
            mondayCheckbox.checked = false;
            mockWeekdayManager.toggleWeekday('monday', false);
            updateMockUI();
            
            // éè¡¨ç¤ºçŠ¶æ…‹ã®ç¢ºèª
            if (!mondayColumn.classList.contains('hidden')) {
                return 'ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’å¤–ã—ã¦ã‚‚åˆ—ãŒéè¡¨ç¤ºã«ãªã‚‰ãªã„';
            }
            
            // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’æˆ»ã™
            mondayCheckbox.checked = true;
            mockWeekdayManager.toggleWeekday('monday', true);
            updateMockUI();
            
            // è¡¨ç¤ºçŠ¶æ…‹ã®ç¢ºèª
            if (mondayColumn.classList.contains('hidden')) {
                return 'ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚‚åˆ—ãŒè¡¨ç¤ºã•ã‚Œãªã„';
            }
            
            return true;
        }

        /**
         * è¤‡æ•°æ›œæ—¥ã®åŒæ™‚å¤‰æ›´ãƒ†ã‚¹ãƒˆ
         */
        function testMultipleWeekdayChanges() {
            const weekendDays = ['saturday', 'sunday'];
            const weekendCheckboxes = weekendDays.map(day => document.getElementById(`show-${day}`));
            const weekendColumns = weekendDays.map(day => document.querySelector(`[data-day="${day}"]`));
            
            // é€±æœ«ã‚’éè¡¨ç¤ºã«ã™ã‚‹
            weekendDays.forEach((day, index) => {
                weekendCheckboxes[index].checked = false;
                mockWeekdayManager.toggleWeekday(day, false);
            });
            
            updateMockUI();
            
            // éè¡¨ç¤ºçŠ¶æ…‹ã®ç¢ºèª
            for (let i = 0; i < weekendColumns.length; i++) {
                if (!weekendColumns[i].classList.contains('hidden')) {
                    return `${weekendDays[i]}ãŒéè¡¨ç¤ºã«ãªã‚‰ãªã„`;
                }
            }
            
            // è¡¨ç¤ºæ›œæ—¥æ•°ã®ç¢ºèª
            const visibleCount = mockWeekdayManager.getVisibleWeekdays().length;
            if (visibleCount !== 5) {
                return `è¡¨ç¤ºæ›œæ—¥æ•°ãŒæ­£ã—ããªã„: æœŸå¾…å€¤5ã€å®Ÿéš›${visibleCount}`;
            }
            
            // é€±æœ«ã‚’å†è¡¨ç¤º
            weekendDays.forEach((day, index) => {
                weekendCheckboxes[index].checked = true;
                mockWeekdayManager.toggleWeekday(day, true);
            });
            
            updateMockUI();
            
            // è¡¨ç¤ºçŠ¶æ…‹ã®ç¢ºèª
            for (let i = 0; i < weekendColumns.length; i++) {
                if (weekendColumns[i].classList.contains('hidden')) {
                    return `${weekendDays[i]}ãŒå†è¡¨ç¤ºã•ã‚Œãªã„`;
                }
            }
            
            return true;
        }

        /**
         * ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®å‹•çš„å¤‰æ›´ãƒ†ã‚¹ãƒˆ
         */
        function testGridLayoutChanges() {
            const taskBoard = document.getElementById('mock-task-board');
            
            // åˆæœŸçŠ¶æ…‹ï¼ˆ7åˆ—ï¼‰ã®ç¢ºèª
            const initialColumns = taskBoard.style.gridTemplateColumns || 'repeat(7, 1fr)';
            if (!initialColumns.includes('7')) {
                return 'åˆæœŸçŠ¶æ…‹ã®ã‚°ãƒªãƒƒãƒ‰åˆ—æ•°ãŒæ­£ã—ããªã„';
            }
            
            // 3ã¤ã®æ›œæ—¥ã‚’éè¡¨ç¤ºã«ã™ã‚‹
            const hideDays = ['wednesday', 'saturday', 'sunday'];
            hideDays.forEach(day => {
                const checkbox = document.getElementById(`show-${day}`);
                checkbox.checked = false;
                mockWeekdayManager.toggleWeekday(day, false);
            });
            
            updateMockUI();
            
            // ã‚°ãƒªãƒƒãƒ‰åˆ—æ•°ã®ç¢ºèªï¼ˆ4åˆ—ã«ãªã‚‹ã¯ãšï¼‰
            const visibleCount = mockWeekdayManager.getVisibleWeekdays().length;
            if (visibleCount !== 4) {
                return `è¡¨ç¤ºæ›œæ—¥æ•°ãŒæ­£ã—ããªã„: æœŸå¾…å€¤4ã€å®Ÿéš›${visibleCount}`;
            }
            
            // å…ƒã«æˆ»ã™
            hideDays.forEach(day => {
                const checkbox = document.getElementById(`show-${day}`);
                checkbox.checked = true;
                mockWeekdayManager.toggleWeekday(day, true);
            });
            
            updateMockUI();
            
            return true;
        }

        /**
         * ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒ†ã‚¹ãƒˆ
         */
        function testDataConsistency() {
            // è¨­å®šã¨UIçŠ¶æ…‹ã®æ•´åˆæ€§ç¢ºèª
            const checkboxes = document.querySelectorAll('.weekday-controls input[type="checkbox"]');
            const dayNames = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            for (let i = 0; i < checkboxes.length; i++) {
                const checkbox = checkboxes[i];
                const dayName = dayNames[i];
                const isChecked = checkbox.checked;
                const isVisible = mockWeekdayManager.isWeekdayVisible(dayName);
                
                if (isChecked !== isVisible) {
                    return `${dayName}ã®è¨­å®šã¨UIçŠ¶æ…‹ãŒä¸€è‡´ã—ãªã„`;
                }
            }
            
            // è¡¨ç¤º/éè¡¨ç¤ºæ›œæ—¥æ•°ã®æ•´åˆæ€§ç¢ºèª
            const visibleCount = mockWeekdayManager.getVisibleWeekdays().length;
            const hiddenCount = mockWeekdayManager.getHiddenWeekdays().length;
            
            if (visibleCount + hiddenCount !== 7) {
                return `è¡¨ç¤ºæ›œæ—¥æ•°ã¨éè¡¨ç¤ºæ›œæ—¥æ•°ã®åˆè¨ˆãŒ7ã§ãªã„: ${visibleCount} + ${hiddenCount}`;
            }
            
            return true;
        }

        /**
         * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆç°¡æ˜“ç‰ˆï¼‰
         */
        function testPerformance() {
            const startTime = performance.now();
            
            // è¤‡æ•°å›ã®åˆ‡ã‚Šæ›¿ãˆã‚’å®Ÿè¡Œ
            for (let i = 0; i < 10; i++) {
                mockWeekdayManager.toggleWeekday('saturday', i % 2 === 0);
                mockWeekdayManager.toggleWeekday('sunday', i % 2 === 1);
                updateMockUI();
            }
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            // 500msä»¥å†…ã«å®Œäº†ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
            if (duration > 500) {
                return `ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã«å¤±æ•—: ${duration.toFixed(2)}ms > 500ms`;
            }
            
            return true;
        }

        /**
         * ãƒ¢ãƒƒã‚¯UIã®æ›´æ–°
         */
        function updateMockUI() {
            const columns = document.querySelectorAll('.mock-day-column');
            const taskBoard = document.getElementById('mock-task-board');
            
            columns.forEach((column, index) => {
                const dayName = mockWeekdayManager.dayNames[index];
                const isVisible = mockWeekdayManager.isWeekdayVisible(dayName);
                
                if (isVisible) {
                    column.classList.remove('hidden', 'hiding');
                    column.classList.add('showing');
                    setTimeout(() => column.classList.remove('showing'), 400);
                } else {
                    column.classList.add('hiding');
                    setTimeout(() => {
                        column.classList.add('hidden');
                        column.classList.remove('hiding');
                    }, 400);
                }
            });
            
            // ã‚°ãƒªãƒƒãƒ‰åˆ—æ•°ã‚’æ›´æ–°
            const visibleCount = mockWeekdayManager.getVisibleWeekdays().length;
            taskBoard.style.gridTemplateColumns = `repeat(${visibleCount}, 1fr)`;
        }

        /**
         * å…¨çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
         */
        function runAllIntegrationTests() {
            // çµæœã‚’ãƒªã‚»ãƒƒãƒˆ
            integrationTestResults = { passed: 0, failed: 0, total: 0, details: [] };
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('test-summary').style.display = 'none';
            
            // ç’°å¢ƒã‚’ãƒªã‚»ãƒƒãƒˆ
            resetTestEnvironment();
            
            // ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
            runIntegrationTest('UIæ“ä½œã¨è¨­å®šå¤‰æ›´ã®é€£æºãƒ†ã‚¹ãƒˆ', testUISettingIntegration);
            runIntegrationTest('è¤‡æ•°æ›œæ—¥ã®åŒæ™‚å¤‰æ›´ãƒ†ã‚¹ãƒˆ', testMultipleWeekdayChanges);
            runIntegrationTest('ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®å‹•çš„å¤‰æ›´ãƒ†ã‚¹ãƒˆ', testGridLayoutChanges);
            runIntegrationTest('ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒ†ã‚¹ãƒˆ', testDataConsistency);
            runIntegrationTest('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ', testPerformance);
            
            // ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
            setTimeout(() => {
                displayTestSummary();
            }, 1000);
        }

        /**
         * ãƒ†ã‚¹ãƒˆã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
         */
        function displayTestSummary() {
            const summaryDiv = document.getElementById('test-summary');
            const successRate = ((integrationTestResults.passed / integrationTestResults.total) * 100).toFixed(1);
            
            summaryDiv.innerHTML = `
                <h3>çµ±åˆãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h3>
                <p><strong>ç·ãƒ†ã‚¹ãƒˆæ•°:</strong> ${integrationTestResults.total}</p>
                <p><strong>æˆåŠŸ:</strong> ${integrationTestResults.passed}</p>
                <p><strong>å¤±æ•—:</strong> ${integrationTestResults.failed}</p>
                <p><strong>æˆåŠŸç‡:</strong> ${successRate}%</p>
                ${integrationTestResults.failed === 0 ? 
                    '<p style="color: green; font-weight: bold;">ğŸ‰ ã™ã¹ã¦ã®çµ±åˆãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸï¼</p>' : 
                    '<p style="color: red; font-weight: bold;">âš ï¸ ä¸€éƒ¨ã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã€‚</p>'
                }
            `;
            summaryDiv.style.display = 'block';
        }

        /**
         * ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’ãƒªã‚»ãƒƒãƒˆ
         */
        function resetTestEnvironment() {
            // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’å…¨ã¦ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã«
            const checkboxes = document.querySelectorAll('.weekday-controls input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            
            // WeekdayManagerã‚’ãƒªã‚»ãƒƒãƒˆ
            mockWeekdayManager.dayNames.forEach(day => {
                mockWeekdayManager.toggleWeekday(day, true);
            });
            
            // UIã‚’æ›´æ–°
            updateMockUI();
        }

        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        document.addEventListener('DOMContentLoaded', () => {
            const checkboxes = document.querySelectorAll('.weekday-controls input[type="checkbox"]');
            const dayNames = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            checkboxes.forEach((checkbox, index) => {
                checkbox.addEventListener('change', (e) => {
                    const dayName = dayNames[index];
                    mockWeekdayManager.toggleWeekday(dayName, e.target.checked);
                    updateMockUI();
                });
            });
        });
    </script>
</body>
</html>